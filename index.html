<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>å››é€±è®Šå½¢å·¥æ™‚ã€æœˆæ’ç­æª¢æŸ¥å·¥å…·(æ¸¬è©¦ç‰ˆ)</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="excelExporter.js"></script>
  <style>
    #settingPanel {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      margin-bottom: 10px;
      gap: 10px;
    }

    #selectors label,
    #selectors select {
      margin-right: 10px;
    }

    #actionButtons button {
      margin-left: 10px;
    }

    #actionButtons {
      display: flex;
      align-items: center;
    }

    #historyPanel {
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>å››é€±è®Šå½¢å·¥æ™‚ã€æœˆæ’ç­æª¢æŸ¥å·¥å…·(æ¸¬è©¦ç‰ˆ)</h1>

  <div id="info-toggle">â€»èªªæ˜ (é»æ“Šå±•é–‹/æ”¶åˆ)</div>
  <div id="info-content" style="display:none;">
    <!-- èªªæ˜å…§å®¹ç•¥ï¼Œèˆ‡åŸç‰ˆç›¸åŒ -->
  </div>

  <div id="modeSelector">
    <label><input type="checkbox" id="checkboxWeekly" /> å››é€±è®Šå½¢å·¥æ™‚</label>
    <label><input type="checkbox" id="checkboxMonthly" /> æœˆæ’ç­</label>
  </div>

  <div id="settingPanel">
    <div id="selectors">
      <label for="periodStartSelector">ğŸ“… æª¢æŸ¥èµ·å§‹æ—¥ï¼š</label>
      <select id="periodStartSelector"></select>

      <label for="periodCountSelector">ğŸ”¢ é€±æœŸæ•¸ï¼š</label>
      <select id="periodCountSelector"></select>

      <label for="monthSelector">ğŸ—“ï¸ æª¢æŸ¥æœˆä»½ï¼š</label>
      <select id="monthSelector"></select>
    </div>

    <div id="actionButtons">
      <button onclick="exportScheduleToExcel()">ğŸ“¤ åŒ¯å‡ºç­è¡¨çµæœ</button>
      <button onclick="ShiftGroupEditor.toggleSettingPanel()">âš™ï¸ è¨­å®š</button>
      <button id="historyToggleBtn" onclick="TableHistory.toggleHistoryPanel()">ğŸ“‹ ç•°å‹•æ­·å²</button>
    </div>
  </div>

  <input type="file" id="excelFile" accept=".xls,.xlsx" />

  <!-- ğŸ“‹ ç•°å‹•æ­·å²é¢æ¿ï¼ˆç·Šè²¼æŒ‰éˆ•ä¸‹æ–¹ï¼‰ -->
  <div id="historyPanel" style="display:none;">
    <table id="historyTable">
      <thead>
        <tr>
          <th>âœ”ï¸</th>
          <th>å§“å</th>
          <th>æ—¥æœŸ</th>
          <th>ç•°å‹•å‰</th>
          <th>ç•°å‹•å¾Œ</th>
        </tr>
      </thead>
      <tbody id="historyTableBody"></tbody>
    </table>
    <button onclick="TableHistory.restoreSelected()">ğŸ”„ å¾©åŸå‹¾é¸é …ç›®</button>
  </div>

  <div id="customShiftSetting" style="display:none;">
    <h3>è‡ªè¨‚ç­åˆ¥ä»£è™Ÿï¼ˆé€±æœŸèˆ‡æœˆçµ±è¨ˆå…±ç”¨ï¼‰</h3>
    <div id="shiftGroupEditor"></div>
    <button onclick="ShiftGroupEditor.saveShiftGroups()">ğŸ’¾ å„²å­˜è¨­å®š</button>
  </div>

  <div id="weeklyTableContainer" class="table-container"></div>
  <div id="monthlyTableContainer" class="table-container"></div>

  <!-- æ¨¡çµ„åŒ– JS -->
  <script src="config.js"></script>
  <script src="periodStartSelector.js"></script>
  <script src="periodCountSelector.js"></script>
  <script src="monthSelector.js"></script>
  <script src="ui.js"></script>
  <script src="excelLoader.js"></script>
  <script src="dateUtils.js"></script>
  <script src="styleUtils.js"></script>
  <script src="cellSync.js"></script>
  <script src="tableBuilder.js"></script>
  <script src="scheduleRenderer.js"></script>
  <script src="checker.js"></script>
  <script src="modeSelector.js"></script>
  <script src="shiftGroupEditor.js"></script>
  <script src="tableHistory.js"></script>

  <script>
    window.onload = function () {
      const today = new Date();
      renderPeriodStartSelector(today);
      renderPeriodCountSelector();
      renderMonthSelector();
      initModeSelector();

      window.scheduleState = {
        startDate: document.getElementById("periodStartSelector").value,
        periodCount: parseInt(document.getElementById("periodCountSelector").value, 10),
        monthStr: document.getElementById("monthSelector").value,
        selectedRows: []
      };
    };

    ["periodCountSelector", "periodStartSelector", "monthSelector"].forEach(id => {
      document.getElementById(id).addEventListener("change", () => {
        const state = window.scheduleState;
        state.startDate = document.getElementById("periodStartSelector").value;
        state.periodCount = parseInt(document.getElementById("periodCountSelector").value, 10);
        state.monthStr = document.getElementById("monthSelector").value;

        if (state.selectedRows.length && typeof window.renderScheduleTable === "function") {
          window.renderScheduleTable(state.selectedRows);
        }
      });
    });

    document.getElementById("excelFile").addEventListener("change", function () {
      if (this.files.length > 0) {
        handleExcelImport();
      }
    });

    ["checkboxWeekly", "checkboxMonthly"].forEach(id => {
      document.getElementById(id).addEventListener("change", () => {
        if (window.scheduleState?.selectedRows?.length) {
          window.renderScheduleTable(window.scheduleState.selectedRows);
        }
      });
    });

    document.getElementById("info-toggle").addEventListener("click", function () {
      const infoContent = document.getElementById("info-content");
      infoContent.style.display = (infoContent.style.display === "none" || infoContent.style.display === "") ? "block" : "none";
    });
  </script>
</body>
</html>
